{% comment %} convert our dates to Number of seconds 
              since 1970-01-01 00:00:00 UTC {% endcomment %}
{% assign time = 'now' | date: '%s' %}

<div id="ishispecialdeal">
  <div class="product_content">
          <div class="section-header">
            <h2>{{ section.settings.main-title | escape }}</h2>
          </div>
        {% assign i = 1 %}
        <div id="specialdealcarousel" class="specialdealcarousel-{{ section.id }} products-display owl-carousel owl-theme">
          {% for block in section.blocks %}
            {% assign datestart = block.settings.startdate | date: "%s" %}
            {% assign dateend = block.settings.enddate |  date: "%s" %}
            {% if datestart <= time and dateend > time %}
              {%- assign product = all_products[block.settings.product] -%}
              <div class="grid__item grid__item--{{section.id}} productdeal"
                data-dealcounter="{{ block.settings.enddate }} 00:00:00"
                >
                <div class="grid-view-item{% unless product.available %} product-price--sold-out grid-view-item--sold-out{% endunless %}">
                  <div class="grid-view-item__link grid-view-item__image-container">
                    {% capture img_id %}ProductCardImage-{{ section.id }}-{{ product.id }}{% endcapture %}
                    {% capture wrapper_id %}ProductCardImageWrapper-{{ section.id }}-{{ product.id }}{% endcapture %}
                    {%- assign img_url = product.featured_image | img_url: '1x1' | replace: '_1x1.', '_{width}x.' -%}
                    <div class="row">
                      <div class="grid-view-item__image-wrapper js col-sm-5 col-xs-12">
                        <a href="{{ product.url | within: collection }}">
                          <div class="image-inner">
                            <div class="reveal">
                              <img 
                               class="grid-view-item__image lazyload {% unless product.images[1] == blank %} main-img {% endunless %}"
                               src="{{ product.featured_image | img_url: '370x480' }}"
                               data-widths="[180, 360, 540, 720, 900, 1080, 1296, 1512, 1728, 2048]"
                                data-sizes="auto"
                               alt="{{ product.featured_image.alt | escape }}">
                               {% unless product.images[1] == blank %}
                                <img class="extra-img" src="{{ product.images[1] | img_url: '370x480' }}" alt="{{ product.images[1].alt | escape }}" />
                              {% endunless %}
                               <span class="outstock-overlay">{{ 'products.product.sold_out' | t }}</span>
                            </div>
                            <div class="hide imgurl-for-quickview">
                              {% for image in product.images %}
                                <span>{{image | img_url: '1000x1000'}}</span>
                              {% endfor %}
                            </div>
                            <div class="hide socialurl-for-quickview">
                              <span>
                              </span>
                            </div>
                          </div>
                        </a>
                        <div class="thumbnail-buttons">
                            <div class="quick-view">
                              <button class="btn" data-toggle="modal">{% include 'icons' with 'quickview' %}<span>{{ 'products.product.quickview' | t }}</span></button>
                            </div>
                             {% include 'wishlist-icon' %}
                            <div class="product-block-hover grid-hover">
                              <div class="qv-cartmain add_to_cart_main grid-cart hide">
                                <form action="/cart/add" method="post" class="add-to-cart product-form product-form-{{ section.id }}" data-section="{{ section.id }}">
                                  <div class="product-selector">
                                    {% unless product.options.size == 1 and product.variants[0].title == 'Default Title' %}
                                      {% for option in product.options_with_values %}
                                        <div class="selector-wrapper js product-form__item">
                                          <label {% if option.name == 'default' %} class="label--hidden" {% endif %}>
                                            {{ option.name }}
                                          </label>
                                          <select class="single-option-selector" data-index="option{{ forloop.index }}">
                                            {% for value in option.values %}
                                              <option value="{{ value | escape }}"{% if option.selected_value == value %} selected="selected"{% endif %}>{{ value }}</option>
                                            {% endfor %}
                                          </select>
                                        </div>
                                      {% endfor %}
                                      <div class="ishi-quickview-swatch">
                                        {% for option in product.options_with_values %}
                                          <div class="ishi-custom-swatch">
                                            <label {% if option.name == 'default' %}class="label--hidden" {% endif %}>
                                              {{ option.name }}
                                            </label>
                                            <div class="option-swatch" data-selector="option{{ forloop.index }}">
                                              {% for value in option.values %}
                                                {% if option.name == 'color' or option.name == 'Color'%}
                                                    <span class="custom-swatch color-swatch{% if option.selected_value == value %} active{% endif %}" style="background-color: {{ value }};" data-index="{{ forloop.index | minus:1}}"></span>
                                                {% else %}
                                                    <span class="custom-swatch{% if option.selected_value == value %} active{% endif %}" data-index="{{ forloop.index | minus:1}}"> {{ value }}</span>
                                                {% endif%}
                                                {% endfor %}
                                            </div>
                                          </div>
                                        {% endfor %}
                                      </div>
                                    {% endunless %}
                                  </div>
                                  <select name="id" data-section="{{ section.id }}" class="product-form__variants no-js">
                                    {% for variant in product.variants %}
                                       <option {% if variant == product.selected_or_first_available_variant %} selected="selected" {% endif %} value="{{ variant.id }}" data-available="{% if variant.available %}1{% else %}0{% endif %}" data-price="{{variant.price | money }}" data-compareatprice="{{variant.compare_at_price | money }}" {% unless variant.available %}disabled="disabled"{% endunless %}>{{ variant.title | escape | strip_html | strip_newlines}}</option>
                                    {% endfor %}
                                  </select>
                                    <div class="product-form__item product-form__item--quantity">
                                      <div class="dec button qtyminus">-</div>
                                      <input name="quantity" value="1" class="quantity">
                                      <div class="inc button qtyplus">+</div> 
                                    </div>
                                  <div class="product-form__item product-form__item--submit">
                                    {% if product.available == false %}
                                      <a href="javascript: void(0)" class="addToCart  sold-out enable btn">
                                        <span>
                                         {{ 'products.product.sold_out' | t }}
                                       </span>
                                      </a>
                                      {% elsif product.variants[1] != blank %}
                                      <a href="javascript: void(0)" class="qv-addToCart addToCart enable btn">
                                        <span class="instock">
                                          {{ 'products.product.add_to_cart' | t }}
                                        </span>
                                        <span class="outstock">
                                         {{ 'products.product.sold_out' | t }}
                                       </span>
                                       <span class="adding">
                                         {{ 'products.product.adding' | t }}
                                       </span>
                                      </a>
                                      {% else %}
                                      <a href="javascript: void(0)"  class="qv-addToCart  addToCart enable btn">
                                        <span class="instock">
                                          {{ 'products.product.add_to_cart' | t }}
                                        </span>
                                        <span class="adding">
                                         {{ 'products.product.adding' | t }}
                                       </span>
                                      </a>
                                      {% endif %}
                                  </div>
                                  <input type="hidden" name="return_to" value="back" />
                                </form>
                              </div>
                              <div class="nm-cartmain add_to_cart_main grid-cart">
                                <form action="/cart/add" method="post" class="add-to-cart product-form product-form-{{ section.id }}" data-section="{{ section.id }}">

                                  <select name="prduct-variant" data-section="{{ section.id }}" class="product-form__variants no-js">

                                    {% for variant in product.variants %}
                                      <option {% if variant == product.selected_or_first_available_variant %} selected="selected" {% endif %} value="{{ variant.id }}" data-available="{% if variant.available %}1{% else %}0{% endif %}" {% unless variant.available %}disabled="disabled"{% endunless %}>{{ variant.title | escape | strip_html | strip_newlines}}</option>
                                    {% endfor %}
                                  </select>
                                  {% for variant in product.variants %}
                                  {% if variant == product.selected_or_first_available_variant %} 
                                  <input type="text" name="prduct-variant" value="{{ variant.id }}" class="product-form__input">
                                  {% endif %}
                                  {% endfor %}
                                  <input type="number" name="product-quantity" value="1" min="1" class="product-form__input">

                                  <div class="product-form__item product-form__item--submit">
                                    {% if product.available == false %}
                                    <a href="{{ product.url | within: collection }}" class="addToCart sold-out enable btn">
                                      {% include 'icons' with 'addtocart' %}
                                      <span>
                                           {{ 'products.product.sold_out' | t }}
                                      </span>
                                    </a>
                                    {% elsif product.variants[1] != blank %}
                                    <a href="{{ product.url | within: collection }}" class="addToCart enable btn">
                                      {% include 'icons' with 'addtocart' %}
                                      <span >
                                         {{ 'products.product.select' | t }}
                                      </span>
                                    </a>
                                    {% else %}
                                    <a href="javascript: void(0)"  class="nm-addToCart addToCart enable btn">
                                      {% include 'icons' with 'addtocart' %}
                                      <span>
                                          {{ 'products.product.add_to_cart' | t }}
                                      </span>
                                    </a>
                                    {% endif %}
                                  </div>
                                </form>
                              </div>
                            </div>
                        </div>
                      </div>
                      <div class="product-description col-sm-7 col-xs-12">
                        <div class="product-detail">
                          <a href="{{ product.url | within: collection }}">
                          <div class="h4 grid-view-item__title">{{ product.title }}</div>
                        </a>
                        </div> 
                         {%- assign truncate_desc =  settings.show_description -%}
                         <div class="product-desc"> {{ product.description | strip_html | truncate: truncate_desc  }}  </div>
                        <span class="shopify-product-reviews-badge" data-id="{{ product.id }}"></span>
                        <div class="grid-view-item__meta">
                          {% include 'product-price' %}
                        </div>
                        <div id="productcountdown{{ i }}" class="productcountdown">
                           <div class="countdown-text">{{ 'general.counter.offertittle' | t }}</div>
                            <div class="countdown-days countdown">
                                <div class="data"></div>
                                <div class="text">{{ 'general.counter.days' | t }}</div>
                            </div>
                            <div class="countdown-hours countdown">
                                <div class="data"></div>
                                <div class="text">{{ 'general.counter.hours' | t }}</div>
                            </div>
                            <div class="countdown-minutes countdown">
                                <div class="data"></div>
                                <div class="text">{{ 'general.counter.minutes' | t }}</div>
                            </div>
                            <div class="countdown-seconds countdown">
                                <div class="data"></div>
                                <div class="text">{{ 'general.counter.seconds' | t }}</div>
                            </div>
                        </div>
                      </div>
                    </div>
                      <noscript>
                        {% capture image_size %}{{ max_height }}x{{ max_height }}{% endcapture %}
                        <img class="grid-view-item__image" src="{{ product.featured_image.src | img_url: image_size, scale: 2 }}" alt="{{ product.featured_image.alt }}" style="max-width: {{ max_height | times: product.featured_image.aspect_ratio }}px;">
                      </noscript>
                  </div>
                </div>
              </div>
            {% endif %}
            {% assign i = i | plus: 1 %}
          {% endfor %}
        </div>
        {% if section.settings.show_view_all %}
          <div class="view-all-btn text-center">
            <a href="{{ collection.url }}" class="btn">
              {{ 'collections.general.view_all' | t }}
            </a>
          </div>
        {% endif %}
  </div>
</div>

<script type="text/javascript">
   $(document).ready(function () {  
    {% assign i = 1 %}
      {% for block in section.blocks %}
      $('.specialdealcarousel-{{ section.id }} .productdeal').each(function() {
        var time = $(this).data('dealcounter');
        var container = $(this).find('#productcountdown{{ i }}');
        
        $(container).countdown(time, function(event) {
            $(this).find(".countdown-days .data").html(event.strftime('%D'));
            $(this).find(".countdown-hours .data").html(event.strftime('%H'));
            $(this).find(".countdown-minutes .data").html(event.strftime('%M'));
            $(this).find(".countdown-seconds .data").html(event.strftime('%S'));
            ;
        });
      });
      {% assign i = i | plus: 1 %}
      {% endfor %}
  });

  jQuery(document).ready(function() {
     $(".specialdealcarousel-{{ section.id }}").owlCarousel({
      nav: true, // Show next and prev buttons
      navText: ['<i class=\'material-icons\'></i>','<i class=\'material-icons\'></i>'],
      dots: false,
      loop: false,
      rewind: true,
      margin: 30,
      responsive:{
        0:{
          items:1
        },
        544:{
          items:2
        },
        768:{
          items:1
        },
        992:{
          items:1
        },
        1200:{
          items:2
        }
      }
    });  
  });

</script>



{% schema %}
  {
    "name": "Ishi Special Deal",
    "class": "index-section specialdeal",
    "settings": [
      {
        "type": "text",
        "id": "main-title",
        "label": "Main Title",
        "default": "DEAL OF THE DAY"
      }
    ],
    "blocks": [
      {
        "type": "logo_image",
        "name": "Product",
        "settings": [
          {
          "id": "product",
          "type": "product",
          "label": "Select Your Product"
          },
          {
            "type": "text",
            "id": "startdate",
            "label": "Start Date",
            "placeholder": "YYYY-MM-DD"
          },
          {
            "type": "text",
            "id": "enddate",
            "label": "End Date",
            "placeholder": "YYYY-MM-DD"
          }
        ]
      } 
    ],
    "presets": [
      {
        "name": "Ishi Special Deal",
        "category": "ishi themes"
      }
    ]
  }
{% endschema %}
